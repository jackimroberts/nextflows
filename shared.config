/*
 * Shared configuration for ATAC-seq and scRNA-seq pipelines
 */

process {
    // Common SLURM settings
    executor       = 'slurm'
    clusterOptions = "--partition=kingspeak-shared --qos=kingspeak --account=vetter -o slurmjob-%j.out-%N -e slurmjob-%j.err-%N"
    maxRetries     = 1
    errorStrategy  = { task.attempt <= 3 ? 'retry' : 'finish' }
    cache          = 'lenient'
    
    // Default resource settings
    memory = 8.GB
    cpus = 2
    
    resourceLimits = [memory: 250.GB]
    
    // Common process settings
    withName: get_fastq {
        memory = { 8.GB + ((task.attempt - 1) * 8.GB) }
        cpus = 8
    }
    
    withName: decompress {
        memory = { 16.GB + ((task.attempt - 1) * 8.GB) }
        cpus = 4
    }
    
    withName: miniaturize {
        memory = { 4.GB + ((task.attempt - 1) * 2.GB) }
        cpus = 2
    }
    
    // Run minimal processes locally
    withName: 'make_sample_table' {
        executor = 'local'
        memory = 1.GB
        cpus = 1
    }
}